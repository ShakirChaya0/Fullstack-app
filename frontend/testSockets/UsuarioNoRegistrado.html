<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<script type="module">
    import { io } from 'https://cdn.socket.io/4.3.2/socket.io.esm.min.js';

    const ws = new io('ws://localhost:3000',{
        auth: {
            qrToken: "17134ce5-d71b-494d-ba32-999bf44a0906",
        }
    });

    ws.on('errorEvent', (data) => {
        console.log(data)
    })

    ws.on('updatedOrderLineStatus', (data) => {
        console.log(data)
    })

    ws.on('addedOrderLine', (data) => {
        console.log(data)
        const addedOrderLineElement = document.getElementById('addedOrderLine');
        addedOrderLineElement.innerHTML = `<strong>Added Order Line:</strong> ${JSON.stringify(data, null, 2)}`;
    })


    ws.on('modifiedOrderLine', (data) => {
        console.log(data)
        const modifiedOrderLineElement = document.getElementById('modifiedOrderLine');
        modifiedOrderLineElement.innerHTML = `<strong>Modified Order Line:</strong> ${JSON.stringify(data, null, 2)}`;
    })

    ws.on('deletedOrderLine', (data) => {
        console.log(data)
        const element = document.getElementById('deletedOrderLine');
        if (element) element.innerHTML = `<strong>Deleted Order Line:</strong> ${JSON.stringify(data, null, 2)}`;
    })

    ws.on('connect', () => {
        console.log('WebSocket connection opened');

        // ws.emit('addOrderLine', {
        //     orderId: 24,
        //     orderLines: [
        //         {
        //             nombre: "Choripan",
        //             tipo: "Postre",
        //             monto: 150.25,
        //             cantidad: 4
        //         }
        //     ]
        // })

    
        ws.emit('modifyOrder', {
            orderId: 24,
            // lineNumbers: [176, 177],
            data: {
                cantidadCubiertos: 15,
                observacion: "ObservaciÃ³n a pedido",
                // items: [
                //     { cantidad: 8 },
                //     { cantidad: 9 }
                // ]
            }
        })

        
        // ws.emit('deleteOrderLine', {orderId: 24, lineNumber: 182});

    });

    ws.on('message', (data) => {
        console.log('Received message:', data);
    });

    ws.on("newOrder", (order) => {
        console.log(order);
    })

    ws.on('close', () => {
        console.log('WebSocket connection closed');
    });

    ws.on('error', (error) => {
        console.error('WebSocket error:', error);
    });
</script>
<body>
    <h1>Test WebSockets </h1>
    <div>
        <h2>Socket Events:</h2>
        <p id="addedOrderLine">Waiting for addedOrderLine event...</p>
    </div>
    <div style="margin-bottom: 20px;">
            <h3>Deleted Order Line:</h3>
            <p id="deletedOrderLine" style="background: #ffebee; padding: 10px; white-space: pre-wrap;">Waiting for deletedOrderLine event...</p>
    </div>
    <div style="margin-bottom: 20px;">
            <h3>Modified Order Line:</h3>
            <p id="modifiedOrderLine" style="background: blue; padding: 10px; white-space: pre-wrap;">Waiting for modifiedOrderLine event...</p>
    </div>
</body>
</html>