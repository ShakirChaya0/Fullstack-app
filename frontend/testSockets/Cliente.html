<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<script type="module">
    import { io } from 'https://cdn.socket.io/4.3.2/socket.io.esm.min.js';

    const ws = new io('ws://localhost:3000',{
        auth: {
            qrToken: "e185e54f-e7c2-4931-aefe-6b3605e0096d",
            jwt: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZFVzdWFyaW8iOiIwZGM4ZDVjZi04ZTI5LTQzNmItOTVhNS1mNTUyYTA1MzY3NDgiLCJlbWFpbCI6InRlc3QyQGdtYWlsLmNvbSIsInRpcG9Vc3VhcmlvIjoiQ2xpZW50ZSIsInVzZXJuYW1lIjoiVGVzdDIiLCJpYXQiOjE3NTU2MTExMTEsImV4cCI6MTc1NjIxNTkxMX0.o71-CnSzNTC_AOPlXntAdG_0SxWDVhjKkF5p-DDkT-o"
        }
    });

    ws.on('errorEvent', (data) => {
        console.log(data)
    })

    ws.on('updatedOrderLineStatus', (data) => {
        console.log(data)
    })

    ws.on('addedOrderLine', (data) => {
        console.log(data)
        const addedOrderLineElement = document.getElementById('addedOrderLine');
        addedOrderLineElement.innerHTML = `<strong>Added Order Line:</strong> ${JSON.stringify(data, null, 2)}`;
    })


    ws.on('modifiedOrderLine', (data) => {
        console.log(data)
        const modifiedOrderLineElement = document.getElementById('modifiedOrderLine');
        modifiedOrderLineElement.innerHTML = `<strong>Modified Order Line:</strong> ${JSON.stringify(data, null, 2)}`;
    })

    ws.on('deletedOrderLine', (data) => {
        console.log(data)
        const element = document.getElementById('deletedOrderLine');
        if (element) element.innerHTML = `<strong>Deleted Order Line:</strong> ${JSON.stringify(data, null, 2)}`;
    })

    ws.on('connect', () => {
        console.log('WebSocket connection opened');

        // ws.emit('addOrderLine', {
        //     orderId: 37,
        //     orderLines: [
        //         {
        //             nombre: "Empanada de Carne",
        //             tipo: "Entrada",
        //             monto: 7000,
        //             cantidad: 2
        //         }
        //     ]
        // })

    
        ws.emit('modifyOrder', {
            orderId: 37,
            lineNumbers: [65],
            data: {
                cantidadCubiertos: 3,
                observacion: "La empanada tiene que ser de Carne",
                items: [
                    { cantidad: 3 }
                ]
            }
        })

        
        // ws.emit('deleteOrderLine', {orderId: 24, lineNumber: 182});

    });

    ws.on('message', (data) => {
        console.log('Received message:', data);
    });

    ws.on("newOrder", (order) => {
        console.log(order);
    })

    ws.on('close', () => {
        console.log('WebSocket connection closed');
    });

    ws.on('error', (error) => {
        console.error('WebSocket error:', error);
    });
</script>
<body>
    <h1>Test WebSockets </h1>
    <div>
        <h2>Socket Events:</h2>
        <p id="addedOrderLine">Waiting for addedOrderLine event...</p>
    </div>
    <div style="margin-bottom: 20px;">
            <h3>Deleted Order Line:</h3>
            <p id="deletedOrderLine" style="background: #ffebee; padding: 10px; white-space: pre-wrap;">Waiting for deletedOrderLine event...</p>
    </div>
    <div style="margin-bottom: 20px;">
            <h3>Modified Order Line:</h3>
            <p id="modifiedOrderLine" style="background: blue; padding: 10px; white-space: pre-wrap;">Waiting for modifiedOrderLine event...</p>
    </div>
</body>
</html>