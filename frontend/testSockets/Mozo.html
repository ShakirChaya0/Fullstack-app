<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<script type="module">
    import { io } from 'https://cdn.socket.io/4.3.2/socket.io.esm.min.js';

    const ws = new io('ws://localhost:3000',{
        auth: {
            jwt: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZFVzdWFyaW8iOiIzYTIwMDQyNS0zYTU2LTRmYWEtYTA3Yy1lY2UwYjdkMmFjZWQiLCJlbWFpbCI6Im1hcnRpbmdhbHZhbm9AZ21haWwuY29tIiwidGlwb1VzdWFyaW8iOiJNb3pvIiwidXNlcm5hbWUiOiJIZXJsYXVtYXJzYW4iLCJpYXQiOjE3NTQ5NDk2ODYsImV4cCI6MTc1NTU1NDQ4Nn0.v07iAGmEx4ehUkcMWOaNbw4sneLimowfxU07kaPbLw4"
        }
    });

    const orderLinesToAdd = {
        orderId: 1,
        items: [
            {
            "nombre": "Producto 1 de Web Scoket",
            "tipo": "Entrada",
            "monto": 150.25,
            "cantidad": 4
            },
            {
            "nombre": "Producto alternativo Web Socket",
            "monto": 1800.00,
            "cantidad": 1,
            "esAlcoholica": false
            }
        ]
    }

    // const orderToModify = {
    //     cantidadCubiertos: 2,
    //     observacion: "Mesa junto a la puerta",
    //     items: [
    //         {
    //         "nombre": "Empanadas sin Usuario Por web socket",
    //         "tipo": "Entrada",
    //         "monto": 150.25,
    //         "cantidad": 4
    //         },
    //         {
    //         "nombre": "Bife de chorizo",
    //         "tipo": "Plato_Principal",
    //         "monto": 2000,
    //         "cantidad": 2
    //         },
    //         {
    //         "nombre": "Vino Malbec",
    //         "monto": 1800.00,
    //         "cantidad": 1,
    //         "esAlcoholica": false
    //         }
    //     ]   
    // }

    // const orderLineToDelete = {
    //     orderId: 1,
    //     lineNumber: 1
    // }
    
    // ws.on('updatedLine', (data) => {
    //     console.log(data)
    // })

    ws.emit('addOrderLine', {
        orderId: 1,
        items: [
            {
            "nombre": "Producto 1 de Web Scoket",
            "tipo": "Entrada",
            "monto": 150.25,
            "cantidad": 4
            },
            {
            "nombre": "Producto alternativo Web Socket",
            "monto": 1800.00,
            "cantidad": 1,
            "esAlcoholica": false
            }
        ]
    })

    ws.on('addedOrderLine', (data) => {
        console.log(data)
    })

    // ws.emit('modifyOrder', orderToModify)

    // ws.on('modifiedOrderLine', (data) => {
    //     console.log(data)
    // })

    // ws.emit('deleteOrderLine', orderToModify)

    // ws.on('deletedOrderLine', (data) => {
    //     console.log(data)
    // })

    ws.on('open', () => {
        console.log('WebSocket connection opened');
        ws.send('Hello, server!');
    });

    ws.on('message', (data) => {
        console.log('Received message:', data);
    });

    ws.on("newOrder", (order) => {
        console.log(order);
    })

    ws.on('close', () => {
        console.log('WebSocket connection closed');
    });

    ws.on('error', (error) => {
        console.error('WebSocket error:', error);
    });
</script>
<body>
    <h1>Test WebSockets </h1>
</body>
</html>